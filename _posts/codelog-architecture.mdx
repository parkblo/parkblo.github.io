---
title: CodeLog ê°œë°œê¸° (1) ì•„í‚¤í…ì²˜ì™€ ì½”ì–´ íŒ¨í„´
date: '2026-01-04'
description: Next.js App Router í™˜ê²½ì—ì„œ ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ë¥¼ ì ìš©í•˜ê³  TypeScriptë¡œ íƒ€ì… ì•ˆì „ì„±ì„ í™•ë³´í•œ ê³¼ì •ì„ ë‹¤ë£¹ë‹ˆë‹¤.
category: Front-End
icon: "pixelart-icons-font-building"
---

## 1. ë“¤ì–´ê°€ë©°: ê¸°íš ì˜ë„

ì˜¤ë¡œì§€ ê°œë°œìë¥¼ ìœ„í•œ SNSê°€ ìˆë‹¤ë©´ ì–´ë–¤ ëª¨ìŠµì¼ê¹Œìš”? ìš°ë¦¬ëŠ” ìŠ¤ë ˆë“œ(Threads), X, ë§í¬ë“œì¸ ë“± ë‹¤ì–‘í•œ í”Œë«í¼ì—ì„œ í…Œí¬ ì†Œì‹ì„ ì ‘í•˜ê³¤ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì†Œí†µ ê³¼ì •ì—ì„œ ì†ŒìŠ¤ ì½”ë“œê°€ ì¤‘ì‹¬ì´ ë˜ëŠ” ê²½í—˜ì€ ì—¬ì „íˆ ë¶€ì¡±í•˜ë‹¤ê³  ëŠê¼ˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ì €ëŠ” ë¹„ë¡ SNS í˜•íƒœì´ì§€ë§Œ, ì†ŒìŠ¤ ì½”ë“œ ê·¸ ìì²´ë¥¼ ê¹Šì´ ìˆê²Œ ë‹¤ë£° ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ë¥¼ êµ¬ìƒí–ˆìŠµë‹ˆë‹¤. ê·¸ í•µì‹¬ìœ¼ë¡œ ë™ë£Œì˜ ì½”ë“œë¥¼ ì§ì ‘ ê²€í† í•˜ëŠ” **'ì½”ë“œ ë¦¬ë·°'**ë¥¼ ì„ ì •í–ˆìŠµë‹ˆë‹¤. AIì˜ ë¦¬ë·° ì„±ëŠ¥ì´ ë¹„ì•½ì ìœ¼ë¡œ ë°œì „í–ˆì§€ë§Œ, ì—¬ì „íˆ ì‚¬ëŒ ëŒ€ ì‚¬ëŒìœ¼ë¡œ ì „í•´ì§€ëŠ” ë§¥ë½ê³¼ í”¼ë“œë°±ì€ ëŒ€ì²´ ë¶ˆê°€ëŠ¥í•œ ê°€ì¹˜ê°€ ìˆë‹¤ê³  ë¯¿ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë™ì‹œì— ë§ˆì´í¬ë¡œ ë¸”ë¡œê·¸ì˜ ê°€ì¹˜ì—ë„ ì£¼ëª©í–ˆìŠµë‹ˆë‹¤. ê¹Šì´ ìˆëŠ” ê¸°ìˆ  ì•„í‹°í´ë„ ì¤‘ìš”í•˜ì§€ë§Œ, ë§¤ì¼ ê²ªëŠ” ì†Œì†Œí•œ ë°°ì›€ê³¼ ë°œê²¬ì„ ë¶€ë‹´ ì—†ì´ ê¸°ë¡í•˜ê³  ê³µìœ í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ë™ë£Œë“¤ì—ê²Œ ìƒˆë¡œìš´ ì‹œì•¼ë¥¼ ì œê³µí•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ ê¸°ëŒ€í–ˆìŠµë‹ˆë‹¤.

## 2. í”„ë¡œì íŠ¸ì˜ ëª©í‘œ

ì´ í”„ë¡œì íŠ¸ëŠ” í˜„ì¬ ì›¹ ê°œë°œì˜ í‘œì¤€ìœ¼ë¡œ ìë¦¬ ì¡ì€ `Next.js`ë¥¼ ì‹¤ì „ì—ì„œ í•™ìŠµí•˜ê³ , ë™ì‹œì— ì‹¤ì§ˆì ì¸ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë„êµ¬ë¥¼ ë§Œë“œëŠ” ë° ëª©ì ì´ ìˆìŠµë‹ˆë‹¤. ê°œì¸ í”„ë¡œì íŠ¸ë¡œ ì‹œì‘í•œ ì´ìœ ëŠ” ì €ë§Œì˜ ì†ë„ì— ë§ì¶° ì¶©ë¶„íˆ ê³ ë¯¼í•˜ê³  í•™ìŠµí•˜ë©° ê°œë°œí•  ìˆ˜ ìˆëŠ” í™˜ê²½ì´ í•„ìš”í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë…í•™ìœ¼ë¡œ ì§„í–‰ë˜ëŠ” ê°œì¸ í”„ë¡œì íŠ¸ëŠ” ìì¹« ìµìˆ™í•œ íŒ¨í„´ì—ë§Œ ì•ˆì£¼í•˜ê²Œ ë˜ì–´ ì„±ì¥ì´ ì •ì²´ë  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì™¸ë¶€ì˜ ë§ˆê° ê¸°í•œì´ ì—†ê¸°ì— ë‚œê´€ ì•ì—ì„œ ì‰½ê²Œ ì¤‘ë‹¨ë  ìš°ë ¤ë„ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ê·¹ë³µí•˜ê³ ì ë‹¤ë¥¸ ê°œë°œìë“¤ê³¼ ì†Œí†µí•˜ë©° í•¨ê»˜ ì„±ì¥í•  ìˆ˜ ìˆëŠ” ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ ìŠ¤í„°ë””ë¥¼ ì§ì ‘ ê°œì„¤í•˜ì—¬ ì§€ì† ê°€ëŠ¥í•œ ê°œë°œ ë™ë ¥ì„ í™•ë³´í•˜ê³ ì í–ˆìŠµë‹ˆë‹¤.

ì¶”ê°€ë¡œ, ê°œë°œ ì†ë„ì™€ í•™ìŠµ íš¨ìœ¨ ì‚¬ì´ì˜ ê· í˜•ì„ ìœ„í•´ BaaSì¸ Supabaseë¥¼ ë„ì…í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í”„ë¡œì íŠ¸ê°€ ì§„í–‰ë¨ì— ë”°ë¼ Supabase SDKì— ëŒ€í•œ ì˜ì¡´ì„±ì´ ì§€ë‚˜ì¹˜ê²Œ ë†’ì•„ì§€ëŠ” ë¬¸ì œë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ì–¸ì œë“  ë„êµ¬ì˜ ë³€í™”ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡, ê³„ì¸µí˜• ì•„í‚¤í…ì²˜(Layered Architecture)ë¥¼ ë„ì…í•˜ì—¬ êµ¬ì¡°ì  ì•ˆì •ì„±ì„ í™•ë³´í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

> **BaaS**: Backend as a Service, ë°±ì—”ë“œ ê¸°ëŠ¥ì„ ì„œë¹„ìŠ¤ í˜•íƒœë¡œ ì œê³µ
> **SDK**: Software Development Kit, ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•œ ë„êµ¬ ëª¨ìŒ

## 3. ê³„ì¸µí˜• ì•„í‚¤í…ì²˜: ì´ë¡ ê³¼ ì‹¤ì „ ì ìš©

ì „í†µì ì¸ ì•„í‚¤í…ì²˜ê°€ `Next.js App Router`ë¼ëŠ” í˜„ëŒ€ì ì¸ í”„ë ˆì„ì›Œí¬ì™€ ë§Œë‚¬ì„ ë•Œ, ê° ê³„ì¸µì€ ì–´ë–¤ ì—­í• ì„ ë‹´ë‹¹í•˜ê²Œ ë ê¹Œìš”? ì œê°€ í”„ë¡œì íŠ¸ì— ì ìš©í•œ êµ¬ì¡°ë¥¼ ë³´ë©° ê°™ì´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

### 3-1. Model (`types/`)

- **ì—­í• **: ë°ì´í„°ì˜ í˜•íƒœë¥¼ ì •ì˜í•˜ëŠ” ìˆœìˆ˜í•œ ê°ì²´ (ì‹ë‹¹ì˜ 'ì‹ìì¬')
- ìœ ì €, ê²Œì‹œê¸€ ë“±ì˜ ì¸í„°í˜ì´ìŠ¤ë‚˜ í´ë˜ìŠ¤ ì •ì˜ë¥¼ ì¤‘ì•™ ê´€ë¦¬í•©ë‹ˆë‹¤.
- _ì˜ˆ: `{ id: "uuid", username: "parkblo", nickname: "ë°•ë¸”ë¡œ" ... }`_

### 3-2. View (`components/`, `app/**/page.tsx`)

- **ì—­í• **: ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” í™”ë©´ (ì‹ë‹¹ì˜ 'í”Œë ˆì´íŒ…')
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ëŒ€í•´ì„œëŠ” ì² ì €íˆ ëª°ë¼ì•¼ í•˜ë©°, ì£¼ì–´ì§„ ë°ì´í„°ë¥¼ ë Œë”ë§í•˜ëŠ” ë° ì§‘ì¤‘í•©ë‹ˆë‹¤.

### 3-3. Controller (`page.tsx`, `Server Actions`, `route.ts`)

- **ì—­í• **: ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë°›ëŠ” ì§„ì…ì  (ì‹ë‹¹ì˜ 'ì›¨ì´í„°')
- Next.jsì—ì„œëŠ” íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë°˜ ë¼ìš°íŒ…ì´ ì´ ì—­í• ì„ ëŒ€ì‹ í•©ë‹ˆë‹¤. ìš”ì²­ì„ ê²€ì¦í•˜ê³  ì ì ˆí•œ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

| **íŒŒì¼ëª…**              | **Controllerë¡œì„œì˜ ìƒì„¸ ì—­í• **                 |
| :------------------- | :-------------------------------------- |
| **`page.tsx`**       | GET ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ Viewë¥¼ ì¡°ìœ¨          |
| **`Server Actions`** | POST, PUT, DELETE ë“± ìƒíƒœ ë³€ê²½(Mutation)ì„ ì „ë‹´ |
| **`route.ts`**       | REST API ì—”ë“œí¬ì¸íŠ¸ê°€ í•„ìš”í•  ë•Œ ì‚¬ìš©                |
| **`middleware.ts`**  | ì¸ì¦/ì¸ê°€ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ ì „ì²˜ë¦¬                       |

### 3-4. Service (`services/`)

- **ì—­í• **: ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” í•µì‹¬ (ì‹ë‹¹ì˜ 'ì…°í”„')
- "ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”", "í¬ì¸íŠ¸ ì ë¦½" ë“± êµ¬ì²´ì ì¸ ê·œì¹™ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. Controllerë¡œë¶€í„° ì¤‘ë³µë˜ëŠ” ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•˜ê¸°ì— ìµœì ì˜ ê³„ì¸µì…ë‹ˆë‹¤.

### 3-5. Repository (ê²°ì •: Serviceë¡œ í†µí•©)

- **ì—­í• **: ë°ì´í„° ì €ì¥ì†Œì— ì§ì ‘ ì ‘ê·¼ (ì‹ë‹¹ì˜ 'ì‹ìì¬ ë°°ë‹¬ì›')
- ì´ˆê¸°ì—ëŠ” ë³„ë„ì˜ Repository íŒ¨í„´ì„ ê³ ë ¤í–ˆìœ¼ë‚˜, SDK ìì²´ê°€ ì´ë¯¸ ê°•ë ¥í•œ ë°ì´í„° ì ‘ê·¼ ê³„ì¸µì„ ì œê³µí•˜ê¸°ì— **Serviceì— ê´€ë ¨ ì±…ì„ì„ í†µí•©**í–ˆìŠµë‹ˆë‹¤.
  - `UserRepository`ê°€ ë‹¨ìˆœíˆ SDKì˜ `getUser()`ë¥¼ ë‹¤ì‹œ ê°ì‹¸ëŠ” ê²ƒì€ ë¶ˆí•„ìš”í•œ ì¤‘ë³µ(Over-abstraction)ë§Œ ì´ˆë˜í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

![ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨](/assets/img/codelog-architecture/1.webp)

> Next.jsëŠ” **Request Memoization**, **Data Cache**, **Full Route Cache** ë“± ë‹¤ì¸µì  ìºì‹±ì„ ì œê³µí•©ë‹ˆë‹¤. Next.js 14ê¹Œì§€ëŠ” `fetch`ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ìºì‹±ë˜ì—ˆìœ¼ë‚˜, **Next.js 15+ ë¶€í„°ëŠ” ê¸°ë³¸ê°’ì´ ìºì‹±ë˜ì§€ ì•ŠìŒ(`no-store`)ìœ¼ë¡œ ë³€ê²½**ë˜ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ íš¨ìœ¨ì ì¸ ë°ì´í„° í˜ì¹­ì„ ìœ„í•´ ì˜ë„ì ìœ¼ë¡œ ìºì‹œ ì˜µì…˜ì„ ì§€ì •í•˜ê±°ë‚˜, `revalidatePath`ë¥¼ í†µí•´ í•„ìš”í•œ ì‹œì ì—ë§Œ ìºì‹œë¥¼ ê°±ì‹ í•˜ëŠ” ì œì–´ê°€ í•„ìˆ˜ì ì…ë‹ˆë‹¤.

## 4. ì‹¤ì§ˆì ì¸ êµ¬í˜„ ì‚¬ë¡€: ì¸ì¦(Auth) ë„ë©”ì¸

CodeLogê°€ ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ë¥¼ ì–´ë–»ê²Œ ì‹¤ì „ì—ì„œ í™œìš©í•˜ê³  ìˆëŠ”ì§€, ê°€ì¥ ë³µì¡í•œ ë¡œì§ì´ ë‹´ê¸´ `Auth` ë„ë©”ì¸ì„ í†µí•´ ì‚´í´ë´…ë‹ˆë‹¤.

### 4-1. Service Layer & ê²©ë¦¬ ì „ëµ

êµ¬í˜„ì²´ì— ì˜ì¡´í•˜ì§€ ì•Šê³  ì„œë¹„ìŠ¤ì˜ í–‰ìœ„ë¥¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ì •ì˜í•œ ë’¤, ì„œë²„ í™˜ê²½ì— ìµœì í™”ëœ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

> **ì¸í„°í˜ì´ìŠ¤(Interface)**: í´ë˜ìŠ¤ë‚˜ ì„œë¹„ìŠ¤ê°€ ê³µí†µì ìœ¼ë¡œ ê°€ì ¸ì•¼ í•  'ê·œê²©'

```ts
// services/auth/auth.interface.ts
export interface IAuthService {
  getCurrentUser(): Promise<UserAuth | null>;
  signOut(): Promise<{ error: Error | null }>;
}

// services/auth/server-auth.service.ts
export class ServerAuthService implements IAuthService {
  async getCurrentUser(): Promise<UserAuth | null> {
    const supabase = await createClient();
    const {
      data: { user },
    } = await supabase.auth.getUser();
    if (!user) return null;

    const { data: profile } = await supabase
      .from("users")
      .select("...")
      .eq("id", user.id)
      .single();

    return profile as UserAuth;
  }
}
```

> ì¸ì¦ ë¡œì§ì˜ ì•ˆì •ì„±ì„ ìœ„í•´ ì„œë²„ í™˜ê²½(**Server Functions**)ì—ì„œëŠ” ë§¤ë²ˆ **Request-scoped ì¸ìŠ¤í„´ìŠ¤**ë¥¼ ìƒì„±í•˜ë„ë¡ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ëŠ” ì„œë²„ ì„¸ì…˜ì´ ì„ì´ëŠ” ë³´ì•ˆ ì‚¬ê³ ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. ë°˜ë©´ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œëŠ” ì„±ëŠ¥ì„ ìœ„í•´ **ì‹±ê¸€í†¤**ì„ í™œìš©í•©ë‹ˆë‹¤.

### 4-2. Action Layer & ì‚¬ìš©ì í”¼ë“œë°±

ì„œë²„ ì•¡ì…˜ì€ ì»¨íŠ¸ë¡¤ëŸ¬ ê³„ì¸µìœ¼ë¡œì„œ ìš”ì²­ì„ ì¤‘ê³„í•©ë‹ˆë‹¤. ì´ë•Œ ê³µí†µ ìœ í‹¸ë¦¬í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ **Mutation** ì´í›„ì˜ í”¼ë“œë°± ë¡œì§ì„ í‘œì¤€í™”í•©ë‹ˆë‹¤.

> **Mutation**: ë°ì´í„° ìˆ˜ì • ë° ìƒíƒœ ë³€ê²½ ì‘ì—…

```ts
// utils/handle-action.ts
export async function handleAction<T>(
  promise: Promise<ActionResponse<T>>,
  options?: {
    successMessage?: string;
    onSuccess?: (data: T | null) => void;
    onError?: (error: string) => void;
  },
) {
  try {
    const result = await promise;
    if (result.error) {
      toast.error(result.error);
      options?.onError?.(result.error);
      return null;
    }
    if (result.message || options?.successMessage) {
      toast.success(result.message || options?.successMessage);
    }
    options?.onSuccess?.(result.data || null);
    return result.data;
  } catch (e) {
    toast.error("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");
    return null;
  }
}
```

### 4-3. í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬ì™€ OAuth Callback

ì‚¬ìš©ì ì¸ì¦ ìƒíƒœë¥¼ ë§¤ë²ˆ ì„œë²„ì—ì„œ í™•ì¸í•˜ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤. `AuthProvider`ë¥¼ í†µí•´ ì•± ì „ë°˜ì˜ **ì»¨í…ìŠ¤íŠ¸**ë¥¼ ìœ ì§€í•˜ë©°, `useEffect` ë‚´ì—ì„œ ë¹„ë™ê¸° í•¨ìˆ˜ í˜¸ì¶œ ì‹œ **í´ë¦°ì—… í•¨ìˆ˜**ë¥¼ í†µí•´ ê²½ìŸ ìƒíƒœ(Race Condition)ë¥¼ ë°©ì§€í•˜ëŠ” íŒ¨í„´ì´ ê¶Œì¥ë©ë‹ˆë‹¤. CodeLog ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” `activeUserId.current`ë¥¼ í™œìš©í•˜ì—¬ ì´ë¥¼ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, GitHub ë“± ì™¸ë¶€ ì¸ì¦ ì„±ê³µ í›„ ì‚¬ìš©ìë¥¼ ë³µê·€ì‹œí‚¤ëŠ” `redirectTo` ê²½ë¡œëŠ” ë°˜ë“œì‹œ `/auth/callback` ë¼ìš°íŠ¸ë¥¼ ê±°ì¹˜ë„ë¡ ì„¤ì •í•´ì•¼ ì„œë²„ ì‚¬ì´ë“œ ì„¸ì…˜ì´ ì¿ í‚¤ì— ì •ìƒ ê¸°ë¡ë©ë‹ˆë‹¤.

![OAuth ì¸ì¦ íë¦„](/assets/img/codelog-architecture/2.webp)

---

## 5. ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì˜ ê³µì¡´ íŒ¨í„´

ê³„ì¸µ êµ¬ì¡°ë¥¼ í†µí•´ ì—­í• ì´ ëª…í™•í•´ì¡Œë‹¤ë©´, ë‹¤ìŒ ê³¼ì œëŠ” **ì„œë²„ ì»´í¬ë„ŒíŠ¸(Server Component)ì™€ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸(Client Component)** ì‚¬ì´ì˜ íš¨ìœ¨ì ì¸ ìƒí˜¸ì‘ìš©ì…ë‹ˆë‹¤. Next.js App Router í™˜ê²½ì—ì„œ ë°ì´í„° í˜ì¹­ê³¼ ë Œë”ë§ì„ ì–´ë–»ê²Œ ìµœì í™”í–ˆëŠ”ì§€ ë‹¤ë£¹ë‹ˆë‹¤.

### 5-1. ë°ì´í„° í˜ì¹­: Waterfall resolvingê³¼ Suspense

ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ ëª¨ë“  ë°ì´í„°ë¥¼ `await`ë¡œ ê°€ì ¸ì˜¨ ë’¤ ìì‹ì—ê²Œ ë„˜ê²¨ì£¼ëŠ” ë°©ì‹ì€ **Waterfall(ì§ë ¬ ì²˜ë¦¬)** ë¬¸ì œë¥¼ ì•¼ê¸°í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë°ì´í„° í˜ì¹­ ë¡œì§ì„ ìì‹ ì»´í¬ë„ŒíŠ¸ë¡œ ìœ„ì„í•˜ê³ , `Suspense`ë¡œ ê°ì‹¸ëŠ” íŒ¨í„´ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.

```tsx
// Page.tsx (ë¶€ëª¨)
export default function Page() {
  return (
    <main>
      <Header />
      {/* ë°ì´í„° ë¡œë”©ì€ FeaturedTags ë‚´ë¶€ì—ì„œ ì¼ì–´ë‚¨. ë¶€ëª¨ëŠ” ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ. */}
      <Suspense fallback={<TagSkeleton />}>
        <FeaturedTags />
      </Suspense>
    </main>
  );
}
```

ì´ íŒ¨í„´ì€ ëŠë¦° ë°ì´í„°ê°€ ìˆë”ë¼ë„ í˜ì´ì§€ì˜ ë‹¤ë¥¸ ë¶€ë¶„(Header ë“±)ì„ ì¦‰ì‹œ ë³´ì—¬ì£¼ì–´(TTFB ê°œì„ ) ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

![Suspenseì™€ ë°ì´í„° í˜ì¹­](/assets/img/codelog-architecture/3.webp)


### 5-2. `use` í›…ê³¼ Promise Passing

í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ **"Promiseë¥¼ Propsë¡œ ì „ë‹¬í•˜ê³  `use` í›…ìœ¼ë¡œ í•´ì œ(Unwrap)í•˜ëŠ” íŒ¨í„´"**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ ìŠ¤íŠ¸ë¦¬ë°ì˜ ì´ì ì„ ëˆ„ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// Server Component (Parent)
export default function Page() {
  const tagsPromise = getTrendingTagsAction(); // await ì—†ì´ Promiseë§Œ ìƒì„±

  return (
    <Suspense fallback={<Loader />}>
      <ClientTagSection tagsPromise={tagsPromise} />
    </Suspense>
  );
}

// Client Component (Child)
"use client";
import { use } from "react";

export function ClientTagSection({ tagsPromise }: { tagsPromise: Promise<Tag[]> }) {
  const tags = use(tagsPromise); // ì—¬ê¸°ì„œ ë°ì´í„°ë¥¼ êº¼ë‚´ê³  í•„ìš”ì‹œ Suspend
  return <div>{tags.map(...)}</div>;
}
```

![Promise Passing íŒ¨í„´](/assets/img/codelog-architecture/4.webp)

### 5-3. ìºì‹±ê³¼ ë°ì´í„° ìµœì‹ ì„±

íŠ¸ë˜í”½ ì¦ê°€ì— ëŒ€ë¹„í•´ ë‹¤ì–‘í•œ ìºì‹± ì „ëµì„ í˜¼í•© ì‚¬ìš©í•©ë‹ˆë‹¤.

- **`unstable_cache`**: DB ì¿¼ë¦¬ ê²°ê³¼(ë­í‚¹ ë“±)ë¥¼ ì„œë²„ ë©”ëª¨ë¦¬ì— ìºì‹±
- **`fetch` Cache**: ì™¸ë¶€ API ì‘ë‹µ ìºì‹±
- **Full Route Cache**: ì •ì  í˜ì´ì§€ ìºì‹±

ê·¸ë¦¬ê³  ë°ì´í„° ë³€ê²½ ì‹œì—ëŠ” `revalidateTag("posts")`ì™€ ê°™ì´ íƒœê·¸ ê¸°ë°˜ì˜ On-demand Revalidationì„ ìˆ˜í–‰í•˜ì—¬ ì¦‰ì‹œ ìºì‹œë¥¼ ë¬´íš¨í™”í•©ë‹ˆë‹¤.

### 5-4. í•˜ì´ë“œë ˆì´ì…˜ ë¶ˆì¼ì¹˜: ê²°ì •ë¡ ì  ë‚œìˆ˜

"íƒìƒ‰" ê¸°ëŠ¥ì„ ìœ„í•´ íƒœê·¸ ëª©ë¡ì„ ëœë¤ìœ¼ë¡œ ì„ì„ ë•Œ, ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì˜ `Math.random()` ê²°ê³¼ê°€ ë‹¬ë¼ ë°œìƒí•˜ëŠ” Hydration Errorë¥¼ í•´ê²°í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. ì €ëŠ” ì‹œë“œ(Seed) ê¸°ë°˜ì˜ ê²°ì •ë¡ ì  ë‚œìˆ˜ ìƒì„±ê¸°(Mulberry32 PRNG)ë¥¼ ë„ì…í–ˆìŠµë‹ˆë‹¤.

ì„œë²„ì—ì„œ ìƒì„±í•œ ì‹œë“œê°’(ì˜ˆ: 12345)ì„ í´ë¼ì´ì–¸íŠ¸ì— Propsë¡œ ì „ë‹¬í•˜ë©´, ì–‘ìª½ì—ì„œ ë™ì¼í•œ ë‚œìˆ˜ ìˆœì„œë¥¼ ë³´ì¥ë°›ì•„ í•˜ì´ë“œë ˆì´ì…˜ ë¶ˆì¼ì¹˜ë¥¼ ì™„ë²½íˆ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 6. TypeScriptë¥¼ í™œìš©í•œ ì•ˆì •ì„± ê°•í™”

ê±´ê³ í•œ ì•„í‚¤í…ì²˜ì™€ íš¨ìœ¨ì ì¸ ì»´í¬ë„ŒíŠ¸ íŒ¨í„´ì˜ ë°‘ë°”íƒ•ì—ëŠ” **íƒ€ì… ì•ˆì „ì„±(Type Safety)**ì´ ìˆìŠµë‹ˆë‹¤. BaaS í™˜ê²½ì—ì„œ, DB ìŠ¤í‚¤ë§ˆì™€ í´ë¼ì´ì–¸íŠ¸ íƒ€ì… ê°„ì˜ ê´´ë¦¬ë¥¼ ì¢íˆê¸° ìœ„í•œ ì „ëµì„ ì†Œê°œí•©ë‹ˆë‹¤.

### 6-1. ìœ í‹¸ë¦¬í‹° íƒ€ì…ì˜ ì‹¤ì „ í™œìš© (Pick & Omit)

DB í…Œì´ë¸” íƒ€ì…ì„ ê·¸ëŒ€ë¡œ ì“°ê¸°ë³´ë‹¤ ëª©ì ì— ë§ê²Œ ê°€ê³µí•©ë‹ˆë‹¤.

- **UserAuth (Omit)**: `password`, `deleted_at` ë“± ë¯¼ê°/ë¶ˆí•„ìš” ì •ë³´ ì œì™¸
- **Author (Pick)**: í”„ë¡œí•„ ë Œë”ë§ì— í•„ìš”í•œ `username`, `avatar` ë“±ë§Œ ì„ íƒ
  ì´ë ‡ê²Œ í•˜ë©´ DB ìŠ¤í‚¤ë§ˆê°€ ë³€ê²½ë˜ì–´ë„ `Tables<"users">`ë§Œ ê°±ì‹ í•˜ë©´ ëª¨ë“  íŒŒìƒ íƒ€ì…ì´ ìë™ìœ¼ë¡œ ê²€ì¦ë˜ì–´ ìœ ì§€ë³´ìˆ˜ì„±ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.

### 6-2. Supabase Query Typing (QueryData)

ë³µì¡í•œ ì¡°ì¸ ì¿¼ë¦¬ì˜ ê²°ê³¼ë¥¼ `as unknown as Type`ìœ¼ë¡œ ê°•ì œ í˜•ë³€í™˜í•˜ëŠ” ê²ƒì€ ìœ„í—˜í•©ë‹ˆë‹¤. ëŒ€ì‹  Supabaseì˜ `QueryData` í—¬í¼ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ ìì²´ë¡œë¶€í„° íƒ€ì…ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.

```typescript
// ì¿¼ë¦¬ ê°ì²´ ì •ì˜
const query = supabase
  .from("follows")
  .select(`
    follower:users!follows_follower_id_fkey (id, username, ...)
  `);

// ì¿¼ë¦¬ë¡œë¶€í„° ì •í™•í•œ ë°˜í™˜ íƒ€ì… ìë™ ì¶”ì¶œ
type FollowersWithAuthor = QueryData<typeof query>;

// ì•ˆì „í•œ ë§¤í•‘
const result = (data as FollowersWithAuthor).map(...)
```

ì´ ë°©ì‹ì€ ì¿¼ë¦¬ ë¬¸ì´ë‚˜ í•„ë“œê°€ ë³€ê²½ë˜ë©´ ì¦‰ì‹œ ì»´íŒŒì¼ ì—ëŸ¬ë¥¼ ë°œìƒì‹œì¼œ, ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ì‚¬ì „ì— ë°©ì§€í•©ë‹ˆë‹¤.

### 6-3. Null íƒ€ì… ê°€ë“œ

ë°°ì—´ ë‚´ `null` ê°’ì„ ê±¸ëŸ¬ë‚¼ ë•Œ TSê°€ ì´ë¥¼ ì¸ì§€í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, User Defined Type Guard(`is` í‚¤ì›Œë“œ)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. `filter((u): u is User => u !== null)` íŒ¨í„´ì„ í†µí•´ ë°˜í™˜ íƒ€ì…ì„ `(User | null)[]`ì—ì„œ `User[]`ë¡œ ì¢í˜€ ì•ˆì „í•˜ê²Œ Optional Chaining ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

## 7. ê²°ë¡ 

ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ë¥¼ ë„ì…í•˜ê³  ë¦¬í¬ì§€í„°ë¦¬, ì„œë¹„ìŠ¤, ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì—­í• ì„ ëª…í™•íˆ í•¨ìœ¼ë¡œì¨, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ UI ë¡œì§ì„ íš¨ê³¼ì ìœ¼ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì— Server/Client ì»´í¬ë„ŒíŠ¸ì˜ ì ì ˆí•œ ì—­í•  ë¶„ë°°ì™€ TypeScriptì˜ ê°•ë ¥í•œ íƒ€ì… ì‹œìŠ¤í…œì´ ë”í•´ì ¸, ì‹œìŠ¤í…œì˜ ë³µì¡ë„ê°€ ì¦ê°€í•´ë„ ë°ì´í„°ì˜ ì •í•©ì„±ê³¼ ê°œë°œì˜ ìƒì‚°ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì´ ë§ˆë ¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ êµ¬ì¡°ì  ê³ ë¯¼ë“¤ì€ CodeLogê°€ ê¸°ëŠ¥ ì¶”ê°€ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•˜ë©° ì§€ì† ì„±ì¥í•  ìˆ˜ ìˆëŠ” ì›ë™ë ¥ì´ ë˜ê³  ìˆìŠµë‹ˆë‹¤.

---

# ğŸ·ï¸ References

- [Next.js Caching](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating)
- [React Suspense](https://react.dev/reference/react/Suspense)
- [Supabase TypeScript Guide](https://supabase.com/docs/guides/database/api/generating-types)
- [TypeScript Utility Types](https://www.typescriptlang.org/docs/handbook/utility-types.html)
